---
title: "Bayesâ€™ Theorem & Probability Revision"
format:
  revealjs:
    theme: slides.scss
    incremental: true
    slide-number: true
    logo: ../vchem.png
    html-math-method: katex
    transition: fade
    background-transition: fade
    highlight-style: ayu-mirage
    footer: |
      [Back to Website](../index.html)
editor_options: 
  chunk_output_type: console
editor: source
---

# Learning Objectives and Outline

## Learning Objectives

-   Recognize the importance of Bayes' Theorem within a Decision
    Analysis context

-   Reproduce Bayes' within context of sensitivity/specificity/positive
    & negative predictive values


## Medical Testing

<br>

**Testing is done for:**

-   Screening (primary prevention)

-   Diagnosis (secondary prevention)

-   Monitor and guide treatment (tertiary prevention)

-   Prognosis

::: notes
Keeping Bayes' Theorem in mind, let's jump into diagnostic testing &
then we will see how we would apply Bayes' theorem within the context of
test results

MEDICAL TESTING is done for --

Screening as it relates to primary prevention EX: HPV screening for
cervical cancer prevention

Diagnosis, or secondary prevention EX: Diagnosis of Hepatitis C, which
the earlier diagnosis the better in terms of the disease getting worse
over time

To monitor & guide treatment (otherwise known as tertiary prevention)
EX: Diabetes could be a good example of this -- the goal is to improve
quality of life by limiting or delaying complications, restoring
function, etc.

To make a prognosis EX: The likely course of a disease
:::

## Information for decision making

<br>

**Clinicians have a variety of diagnostic information to guide their
decision making**

-   Talking to patient (history, symptoms)

-   Physically examining patient

-   Screening (cervical cancer) + diagnostic tests (EKGs, Blood tests,
    X-rays)

## Information for decision making

<br>

Obtaining information can be...

::: incremental
-   RISKY <br>

-   EXPENSIVE <br>

-   ERROR PRONE <br>

-   ALL THREE
:::

::: notes
RISKY/INVASIVE -- For example, getting an Amniocentesis during pregnancy
(A medical procedure used primarily in prenatal diagnosis of chromosomal
abnormalities and fetal infections) can significantly increase one's
risk of a miscarriage.

EXPENSIVE -- An MRI, for example, is pricey

ERROR PRONE -- Diagnostic tests, like anything, aren't perfect; though,
some are more perfect than others

ALL THREE --A diagnostic test, for example, could be all three -- risky,
expensive, & not very precise

\*\*We need to factor in these tradeoffs when making decisions
:::

## Role of Decision Analysis Methods

- Can be used to weigh the costs and benefits: 
  - Test costs
  - Test accuracy
  - Health risks of testing

## Example: Diagnostic Tests

What is the chance that a patient has a disease if a diagnostic test is positive
or negative? <br>


## Example: Diagnostic Tests

What is the chance that a patient has a disease if a diagnostic test is positive
or negative? <br>

In other words, what is the probability of disease conditional on the
test result? (D+ \| T+); (D+ \| T-)

## Ways to get revised (posterior) probabilities


<br>

1.  Bayes' theorem <br>
2.  2x2 tables <br>
3.  Bayes' theorem via decision tree inversion  <br>

## Ways to get revised (posterior) probabilities

::: nonincremental
<br>

1.  [Bayes' theorem]{style="background-color: yellow;"}  <br>
2.  2x2 tables <br>
3.  Bayes' theorem via decision tree inversion  <br>

:::

# 1. Bayes' Theorem: Intuition {background="#43464B"}

## Population of 200 indiviudals


![](images/bayes_test1.png){height=600 fig-align="center"}


## Disease (red) has 1% prevalence.


![](images/bayes_test2.png){height=600 fig-align="center"}


## A Screening Test is Available

::: {layout="[[-1], [-1], [1], [-1]]"}
![](images/bayes_test.png){height=100 fig-align="center"}
:::


## Test will detect 100% of positive cases.

![](images/bayes_test3a.png){height=600 fig-align="center"}


## 3% of disease-free individuals will test positive {.smaller}

![](images/bayes_test3.png){height=520 fig-align="center"}


## Eight Positive Tests

\vspace{4em}

::: {layout="[[-1],[-1], [-1], [1], [-1]]"}

![](images/bayes_test4.png){height=100 fig-align="center"}
:::

## Probability of Disease Given Positive Test

::: {layout="[[-1],[-1],  [1], [-1]]"}

![](images/bayes_test5.png){height=80% fig-align="center"}
:::

## Key Points

- While the test *always* detects a true case, it also returns false positives.
- The higher the number of false positives, the lower the probability that a given positive result is actually an individual with the disease.

## False Positives

- Could be the result of a poor test (e.g., 3% false positive rate).
- Or could be the result of a disease with very low prevalence in a large population, but a very good test!
  - In a population of 200 million, a test with a 0.01% false positive rate will yield 20,000 false positive readings!
  - If the disease prevalence is low (e.g., 0.001%, or 2,000 sick individuals), the probability that someone is sick if they test positive is <10%!


# Bayes' Theorem: Theory {background="#43464B"}

## Probability of B

::: columns
::: {.column}
$$
Pr(B) 
$$
:::
::: {.column}
![](images/conditional-1.png)
:::
:::

## Probability of A and B

::: columns
::: {.column width="60%"}
$$
\begin{aligned}
Pr(A \& B) &= Pr(A|B) Pr(B)\\
&= Pr(B|A) Pr(A)
\end{aligned}
$$
:::
::: {.column width="30%"}
![](images/conditional-2.png)
:::
:::



## Probability of A Given B

::: columns
::: {.column}
$$
Pr(A|B) = \frac{Pr(A \& B)}{Pr(B)}
$$
:::
::: {.column}
![](images/conditional-3.png)
:::
:::





## A Perfect Test

![](images/bayes1.png){height=600 fig-align="center"}

## 100% Specificity, <100% Sensitivity

![](images/bayes2.png){height=600 fig-align="center"}

## <100% Specificity, 100% Sensitivity

![](images/bayes3.png){height=600 fig-align="center"}


## Let's Lower Disease Prevalence

![](images/bayes4.png){height=600 fig-align="center"}

## <100% Specificity, <100% Sensitivity

![](images/bayes5.png){height=600 fig-align="center"}

# What is the Probability of Disease Given A Positive Test? {background="#43464B"}

## Probability of Testing Positive if Have Disease

::: columns

::: {.column}
::: {layout="[[-1],  [1], [-1]]"}
![](images/bayes5.png){height=250 fig-align="center"}
:::
:::

::: {.column}
::: {layout="[[-1], [-1], [1], [-1]]"}

![](images/bayes_PrPosBarDisesase.png){height=50 fig-align="center"}
:::
:::
:::


## Probability of Having the Disease

::: columns

::: {.column}
::: {layout="[[-1],  [1], [-1]]"}
![](images/bayes5.png){height=300 fig-align="center"}
:::
:::

::: {.column}

![](images/bayes_PrDisease.png){height=300 fig-align="center"}
:::

:::
## Probability of a Positive Test

::: columns

::: {.column}
::: {layout="[[-1],  [1], [-1]]"}
![](images/bayes5.png){height=300 fig-align="center"}
:::
:::


::: {.column}
![](images/bayes_PrPos.png){height=300 fig-align="center"}
:::
:::

## Bayes' Theorem

::: columns

:::{.column}
::: {layout="[[-1], [-1],[-1], [1], [-1]]"}
![](images/bayes_theorem_.png)
:::
:::

:::{.column}
![](images/bayes_theorem.png){fig-align="center" height="600px"}
:::

:::


::: notes
(1) Bayes theorem describes the probability of an event BASED ON the
    PRIOR knowledge of conditions that might be related to the event

(2) When conducting decision analyses in real life, sometimes, the
    probability of A given B is easier to get (or vice versa) and you're
    not able to find the probability of B given A. So, you can use
    Bayes' theorem to convert probabilities into what you need based on
    the data you have in the real world

(3) Conditional probabilities are related according to Bayes' theorem --
    in other words, it is a way to RELATE conditional probabilities

(4) Explain how to get to Bayes equation\*\*\* NOTE: Pr(B) cannot be 0
    and Pr(A) cannot be 0 or it becomes undefined
:::

## {background-image="images/bayes_test3.png" data-background-size="contain"}

##  {background-image="images/bayes_test3.png" data-background-size="contain" background-opacity="0.1"}

##  {background-image="images/bayes_test3.png" data-background-size="contain" background-opacity="0.1"}

::: columns

:::{.column}
- Population of 200
- Disease (red) has 1% prevalence.
- Test will detect 100% of positive cases.
- 3% of disease-free individuals will test positive 
:::

:::{.column}
::: {layout="[[-1], [-1],[-1], [1], [-1]]"}
![](images/bayes_population0.png)
:::
:::


:::


##  {background-image="images/bayes_test3.png" data-background-size="contain" background-opacity="0.1"}

::: columns

:::{.column}
::: nonincremental
- Population of 200
- Disease (red) has 1% prevalence.
- Test will detect 100% of positive cases.
- 3% of disease-free individuals will test positive 
:::
:::

:::{.column}
::: {layout="[[-1], [-1],[-1], [1], [-1]]"}
![](images/bayes_population1.png)
:::

:::



:::

##  {background-image="images/bayes_test3.png" data-background-size="contain" background-opacity="0.1"}

::: columns

:::{.column}
::: nonincremental
- Population of 200
- Disease (red) has 1% prevalence.
- Test will detect 100% of positive cases.
- 3% of disease-free individuals will test positive 
:::
:::

:::{.column}
::: {layout="[[-1], [-1],[-1], [1], [-1]]"}
![](images/bayes_population2.png)
:::

:::



:::


##  {background-image="images/bayes_test3.png" data-background-size="contain" background-opacity="0.1"}

::: columns

:::{.column}
::: nonincremental
- Population of 200
- Disease (red) has 1% prevalence.
- Test will detect 100% of positive cases.
- 3% of disease-free individuals will test positive 
:::
:::

:::{.column}
::: {layout="[[-1], [-1],[-1], [1], [-1]]"}
![](images/bayes_population3.png)
:::

:::



:::

##  {background-image="images/bayes_test3.png" data-background-size="contain" background-opacity="0.1"}

::: columns

:::{.column}
::: nonincremental
- Population of 200
- Disease (red) has 1% prevalence.
- Test will detect 100% of positive cases.
- 3% of disease-free individuals will test positive 
:::
:::

:::{.column}
::: {layout="[[-1], [-1],[-1], [1], [-1]]"}
![](images/bayes_population3.png)
![](images/bayes_population4.png)
:::

:::



:::

# 2. 2x2 Tables {background="#43464B"}

## 2x2 Example: Disease Testing

**Case example**

You are trying to determine what proportion of the
population has already been exposed a new communicable disease, in hopes of figuring out
if herd immunity is possible.

<br>

You decide to do a  antibody test to measure the level of
antibodies [in a sample of 500 participants]{style="background-color: yellow;"}

## Disease Testing

<br>

**Case example**

What is the test's SENSITIVITY? <br>

What is the test's SPECIFICITY? <br>

What is the test's FALSE NEGATIVE RATE? <br>

What is the test's FALSE POSITIVE RATE? <br>

## Disease Testing

<br>

**Case example**

::: {style="font-size: 0.8em"}
|      | *D+*   | *D-*   |               |
|------|--------|--------|---------------|
| *T+* | a (TP) | b (FP) | a + b         |
| *T-* | c (FN) | d (TN) | c + d         |
|      | a + c  | b + d  | a + b + c + d |
:::

::: notes
One way we can look at these different testing outcomes is through a 2X2
table
:::

## Disease Testing: SENSITIVITY

<br>

::: {style="font-size: 0.8em"}
|      | *D+*            | *D-*        |                     |
|------|-----------------|-------------|---------------------|
| *T+* | **125** (a, TP) | 20 (b, FP)  | 145 (a + b)         |
| *T-* | 9 (c, FN)       | 346 (d, TN) | 355 (c + d)         |
|      | **134** (a + c) | 366 (b + d) | 500 (a + b + c + d) |
:::

<br> Test Sensitivity among those who have or had the virus, [125/134 =
93%]{style="background-color: yellow;"} (Interpretation: The probability
of the screening test correctly identifying diseased subjects was 93%)

::: notes
(1) **Sensitivity** measures how often a test correctly generates a
    positive result for people who had the condition that's being tested
    for (also known as the "true positive" rate).

(2) We would take column A (which is the proportion of people who have a
    positive COVID antibody test & divide that by everyone who truly had
    COVID) --

(3) As a result, we would get the proportion of people that previously
    HAD COVID with a TRUE POSITIVE test

*(to determine those who "truly" had COVID, the study criteria could
have included individuals who had received a range of other confirmatory
tests while they had COVID, including lung examinations, other blood
work, etc.)*

(4) For this example, we get a test sensitivity of 93%

(5) **In other words, a test with 93% sensitivity will correctly return
    a positive result for MOST people who have had COVID BUT will return
    a negative result --- a false-negative --- for 7% of the people who
    have had COVID & should have tested positive**
:::

## Disease Testing: SENSITIVITY

![](images/sensitivity.png)

## Example: SPECIFICITY

<br>

::: {style="font-size: 0.8em"}
|      | *D+*        | *D-*            |                     |
|------|-------------|-----------------|---------------------|
| *T+* | 125 (a, TP) | 20 (b, FP)      | 145 (a + b)         |
| *T-* | 9 (c, FN)   | **346** (d, TN) | 355 (c + d)         |
|      | 134 (a + c) | **366** (b + d) | 500 (a + b + c + d) |
:::

<br> Test Specificity among those without the disease at any point,
[346/366 = 95%]{style="background-color: yellow;"} (Interpretation: The
probability of the screening test correctly identifying non-diseased
subjects was 65%)

::: notes
(1) **Specificity** measures a test's ability to correctly generate a
    **negative result** for people **who don't have the condition** (or
    didn't have the condition in our case) that's being tested for (also
    known as the "true negative" rate).

(2) To calculate the SPECIFICITY of the antibody test, we would take
    column D (which is the proportion of people who tested negative for
    COVID antibodies & divide that by everyone who **truly** did NOT
    have COVID

(3) When we do the calculation, the probability of the antibody test
    correctly identifying those that DID NOT previously have COVID was
    95%

(4) **In other words, a test with 95% specificity will correctly return
    a negative result for MOST people who didn't have the disease BUT
    will return a positive result --- a false-positive --- for 5% of the
    people who didn't have COVID and should have tested negative for the
    antibodies**
:::


## Disease Testing: SPECIFICITY

![](images/specificity.png)

# Do you want a test with good Sensitivity or good Specificity? {background="#43464B"}

::: notes
IT DEPENDS!

EXAMPLE -- HIV TEST

If low SENSITIVITY, you have the risk of producing a lot of
false-negatives, which could be bad for the population & the spread of
the virus + patient not getting the care he/she needs; Not picking up
the disease in people who should be picked up

If low SPECIFICITY, there's an increase risk of false-positive results,
which can be devastating & lead to toxicity implications (if you start
treatment) + grave emotional consequences + increase healthcare costs
Falsely returning positive tests in people that don't have the disease
:::

## False Negatives

<br>

[False negative rate (1-sensitivity)]{style="color: #169873;"} is the
proportion of diseased people with a negative test: c/(a+c)

## False Negatives{background-image="images/false-negative.png" data-background-size="contain" background-opacity="0.1"}

<br>

[False negative rate (1-sensitivity)]{style="color: #169873;"} is the
proportion of diseased people with a negative test: c/(a+c)

## False Negatives{background-image="images/false-negative.png" data-background-size="contain" background-opacity="1.0"}
 
 

## False Positives

<br>

[False positive rate (1-specificity)]{style="color: #169873;"} is the
proportion of non-diseased people with a positive test: b/(b+d)

## False Negatives{background-image="images/false-positive.png" data-background-size="contain" background-opacity="0.1"}

<br>

[False positive rate (1-specificity)]{style="color: #169873;"} is the
proportion of non-diseased people with a positive test: b/(b+d)

## False Negatives{background-image="images/false-positive.png" data-background-size="contain" background-opacity="1.0"}

# Bayes' Theorem With Tree Inversion {background="#43464B"}

## Bayes' theorem with tree inversion

![](images/inversion1.png){fig-align="center" height="400px"}

::: notes
-   Another way that we can revise probabilities based on the
    information we have to work with is inverting the tree

-   We often have information on the P(T+ \| D+) (tree to the right);
    but mathematically, the tree to the left is the same, but it might
    be easier to construct the tree this way given the information you
    have
:::

## Goal: "Flip" The Tree

![](images/inversion2.png){fig-align="center" height="600px"}

## Start Matching Terminal Numbers ... 

![](images/inversion3.png){fig-align="center" height="600px"}

## Continue Matching Terminal Numbers ... 

![](images/inversion4.png){fig-align="center" height="600px"}

## Continue Matching Terminal Numbers ... 

![](images/inversion5.png){fig-align="center" height="600px"}

## Work Your Way Down the Tree ... 

![](images/inversion6.png){fig-align="center" height="600px"}

## Inverted Tree

![](images/inversion7.png){fig-align="center" height="600px"}

## Probability of Disease Given + Test

![](images/inversion8.png){fig-align="center" height="600px"}

## Probability of Disease Given - Test

![](images/inversion9.png){fig-align="center" height="600px"}

## Conclusions

::: incremental
-   We are often bayesian in how we think
-   Knowledge of test characteristics can help you to make more informed
    decisions
-   In general, diagnostic tests are helpful when pre-test prob is in
    the middle (30-70%) and test is going to move you past a decision
    threshold
-   Tests with very good characteristics (ex. 100% sens or spec) can
    also be very useful if used appropriately
:::

::: notes
(1) You don't realize it but you're already thinking about these ratios
    in your head

-   If you're a surgeon and someone comes in and says that their stomach
    hurts, you have a certain probability in your mind that they have
    appendicitis
-   Everyday life and other professions -- Personality tests, who will
    benefit from education intervention; Autism screening

(2) Pre-test probability is a big deal because you don't want to do an
    expensive test with a low pre-test probability, BUT once you find
    additional information then that can change
:::

